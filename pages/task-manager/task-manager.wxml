<navigation-bar title="打卡任务管理" back="{{true}}" color="black" background="#FFF"></navigation-bar>
<view class="manager-container">
  <view class="header">
    <text class="title">打卡任务管理</text>
  </view>

  <scroll-view scroll-y class="content-scroll" type="list" enable-pull-down-refresh="{{true}}" refresher-enabled refresher-triggered="{{refreshing}}" bindrefresherrefresh="onPullDownRefresh">
    <block wx:if="{{loading && !refreshing}}">
      <view class="loading">
        <text class="loading-text">加载中...</text>
      </view>
    </block>

    <block wx:if="{{taskList.length === 0 && !loading}}">
      <view class="empty-tip">
        <text>暂无打卡任务</text>
        <button class="add-btn" bindtap="onCreateTask">创建打卡任务</button>
      </view>
    </block>
    
    <block wx:if="{{taskList.length > 0}}">
      <view class="tasks-container">
        <view wx:for="{{taskList}}" wx:key="_id" class="task-card {{item.isRecentlyModified ? 'modified-task' : ''}}">
          <view class="task-header">
            <text class="task-title">{{item.title}}</text>
            <view class="task-actions">
              <view class="action-btn edit" catchtap="onEditTask" data-id="{{item._id}}">编辑</view>
              <view class="action-btn delete" catchtap="onDeleteTask" data-id="{{item._id}}">删除</view>
            </view>
          </view>
          
          <view class="task-content" bindtap="onTaskDetail" data-id="{{item._id}}">
            <view class="task-desc">{{item.description || '无描述'}}</view>
            <view class="task-meta">
              <view class="meta-item">
                <text class="meta-label">时间周期:</text>
                <text class="meta-value">{{item.timePeriod || '未设置'}}</text>
              </view>
              
              <view class="meta-item">
                <text class="meta-label">打卡类型:</text>
                <text class="meta-value">{{item.checkinType || '未设置'}}</text>
              </view>
              
              <view class="meta-item">
                <text class="meta-label">打卡时间:</text>
                <text class="meta-value">{{item.startDateTime || '未设置'}} - {{item.endDateTime || '未设置'}}</text>
              </view>
              
              <view class="meta-item">
                <text class="meta-label">参与人数:</text>
                <text class="meta-value">{{item.participants.length || 0}}人</text>
              </view>
              
              <view class="meta-item">
                <text class="meta-label">创建日期:</text>
                <text class="meta-value">{{item.createdAtFormatted || '未知'}}</text>
              </view>
            </view>
          </view>
          
          <view wx:if="{{item.isRecentlyModified}}" class="modified-tag">新增/已更新</view>
        </view>
      </view>
      
      <view class="add-task">
        <button class="add-btn" bindtap="onCreateTask">添加新任务</button>
      </view>
    </block>
    
    <!-- 添加底部安全区域 -->
    <view class="safe-area-bottom"></view>
  </scroll-view>
</view> 